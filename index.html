<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Winter is Coming ❄️</title>
<style>
body {
  margin:0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  background-color: #000;
  font-family: Arial, sans-serif;
  -webkit-tap-highlight-color: transparent;
}
#container { display: flex; flex-wrap: wrap; justify-content: center; }
#game {
  position: relative;
  width: 400px;
  height: 400px;
  background-color: #000;
  border: 4px solid #2e7d32;
  touch-action: none;
}
.snake, .cherry, .wall { position: absolute; width: 20px; height: 20px; }
.snake { background-color: #ffeb3b; }
.cherry { background-color: red; border-radius: 50%; }
.wall { background-color: #2e7d32; }
#instructions { color: white; width: 200px; font-size: 16px; margin-top:10px; }
#controls { display: flex; flex-wrap: wrap; width: 140px; margin-top: 10px; }
.btn { 
  width: 60px; height: 60px; 
  margin: 5px; font-size: 24px; background-color: #444; color: #fff; 
  border: none; border-radius: 10px; 
  user-select: none; 
  -webkit-user-select: none;
  touch-action: manipulation;
  outline: none;
}

/* رسالة عيد الميلاد full screen مع confetti */
#birthdayMessage {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.9);
  display: none;
  z-index: 1000;
  overflow: hidden;
  cursor: pointer;
}
#messageText {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  color: #ffeb3b;
  text-align: center;
  font-size: 24px;
}
#messageText h1 {
  animation: pulse 1.5s infinite alternate;
}
@keyframes pulse {
  from { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  to { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
}
#confettiCanvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}
</style>
</head>
<body>
<div id="container">
  <div>
    <div id="game"></div>
    <div id="controls">
      <button class="btn" id="up">↑</button>
      <button class="btn" id="left">←</button>
      <button class="btn" id="down">↓</button>
      <button class="btn" id="right">→</button>
    </div>
  </div>
  <div id="instructions">
    <h3>تعليمات:</h3>
    <p>حرك الدودة الصفراء للوصول إلى الكرزة الحمراء باستخدام الأسهم أو الأزرار أدناه.</p>
    <p>إذا ضربت الدودة الجدار أو نفسها، ستعاد اللعبة تلقائيًا.</p>
  </div>
</div>

<div id="birthdayMessage">
  <canvas id="confettiCanvas"></canvas>
  <div id="messageText">
    <h1>🎉 هنيئاً لك العيد الذي أنت عيدهُ 🎉</h1>
    <p>وأنك من فيض البهاء تزيدهُ</p>
    <p>وإني إذا أهداك غيري وردةً</p>
    <p>سأهديك قلبًا أنت فيهِ وريدهُ</p>
    <small>اضغط أي مكان لإخفاء الرسالة</small>
  </div>
</div>

<audio id="eatSound" preload="auto">
  <source src="https://www.soundjay.com/button/sounds/button-16.mp3" type="audio/mpeg">
</audio>
<audio id="celebrateSound" preload="auto">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6b20364b7d.mp3?filename=happy-birthday-132214.mp3" type="audio/mpeg">
</audio>

<script>
const game = document.getElementById('game');
const grid = 20;
let snake = [{x:40,y:40}];
let dx=0, dy=0;
let cherry = {x:0,y:0};
let walls = [];
const birthdayMessage = document.getElementById('birthdayMessage');
const confettiCanvas = document.getElementById('confettiCanvas');
const ctx = confettiCanvas.getContext('2d');
const eatSound = document.getElementById('eatSound');
const celebrateSound = document.getElementById('celebrateSound');
let confettiParticles = [];

// السماح بتشغيل الصوت بعد أول تفاعل
function enableSounds() {
  eatSound.play().catch(()=>{}); eatSound.pause();
  celebrateSound.play().catch(()=>{}); celebrateSound.pause();
}
window.addEventListener('click', enableSounds, { once: true });
window.addEventListener('keydown', enableSounds, { once: true });

// إعداد canvas للconfetti
function resizeCanvas(){ confettiCanvas.width=window.innerWidth; confettiCanvas.height=window.innerHeight; }
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// إنشاء المتاهة
function createMaze(){
  walls = [];
  for(let i=0;i<400;i+=grid){
    walls.push({x:i,y:0});
    walls.push({x:i,y:380});
    walls.push({x:0,y:i});
    walls.push({x:380,y:i});
  }
  for(let i=60;i<340;i+=grid){
    walls.push({x:i,y:120});
    walls.push({x:i,y:260});
  }
  for(let i=120;i<280;i+=grid){
    walls.push({x:120,y:i});
    walls.push({x:260,y:i});
  }
}

function drawWalls(){
  game.querySelectorAll('.wall').forEach(w=>w.remove());
  walls.forEach(w=>{
    const div=document.createElement('div');
    div.classList.add('wall');
    div.style.left=w.x+'px';
    div.style.top=w.y+'px';
    game.appendChild(div);
  });
}

// الكرزة
const cherryDiv = document.createElement('div');
cherryDiv.classList.add('cherry');
game.appendChild(cherryDiv);

function placeCherry(){
  let valid=false;
  while(!valid){
    cherry.x=Math.floor(Math.random()*20)*grid;
    cherry.y=Math.floor(Math.random()*20)*grid;
    valid=!snake.some(s=>s.x===cherry.x && s.y===cherry.y) && !walls.some(w=>w.x===cherry.x && w.y===cherry.y);
  }
  cherryDiv.style.left=cherry.x+'px';
  cherryDiv.style.top=cherry.y+'px';
}

function drawSnake(){
  game.querySelectorAll('.snake').forEach(s=>s.remove());
  snake.forEach(seg=>{
    const div=document.createElement('div');
    div.classList.add('snake');
    div.style.left=seg.x+'px';
    div.style.top=seg.y+'px';
    game.appendChild(div);
  });
}

function resetGame(){
  snake=[{x:40,y:40}];
  dx=0; dy=0;
  placeCherry();
  drawWalls();
  drawSnake();
}

function createConfetti(){
  confettiParticles=[];
  for(let i=0;i<150;i++){
    confettiParticles.push({
      x:Math.random()*confettiCanvas.width,
      y:Math.random()*confettiCanvas.height - confettiCanvas.height,
      r:Math.random()*6+2,
      color:['#ffeb3b','#ff5252','#00e676','#448aff'][Math.floor(Math.random()*4)],
      dx:(Math.random()-0.5)*2,
      dy:Math.random()*3+2
    });
  }
}

function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confettiParticles.forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,2*Math.PI);
    ctx.fillStyle=p.color;
    ctx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if(p.y > confettiCanvas.height) p.y = -10;
  });
  requestAnimationFrame(drawConfetti);
}

function showBirthdayMessage(){
  birthdayMessage.style.display='block';
  createConfetti();
  drawConfetti();
  celebrateSound.currentTime=0;
  celebrateSound.play();
  eatSound.currentTime=0;
  eatSound.play();
}

birthdayMessage.addEventListener('click',()=>{ birthdayMessage.style.display='none'; });

function moveSnake(){
  const head={x:snake[0].x+dx,y:snake[0].y+dy};
  snake.unshift(head);
  if(head.x===cherry.x && head.y===cherry.y){
    showBirthdayMessage();
    placeCherry();
  } else { snake.pop(); }
  if(walls.some(w=>w.x===head.x && w.y===head.y) || snake.slice(1).some(s=>s.x===head.x && s.y===head.y)){
    resetGame();
  }
  drawSnake();
}

// أزرار التحكم
document.getElementById('up').addEventListener('click',()=>{dx=0;dy=-grid; moveSnake();});
document.getElementById('down').addEventListener('click',()=>{dx=0;dy=grid; moveSnake();});
document.getElementById('left').addEventListener('click',()=>{dx=-grid;dy=0; moveSnake();});
document.getElementById('right').addEventListener('click',()=>{dx=grid;dy=0; moveSnake();});
window.addEventListener('keydown',e=>{
  if(e.key==='ArrowUp'){dx=0;dy=-grid;moveSnake();}
  if(e.key==='ArrowDown'){dx=0;dy=grid;moveSnake();}
  if(e.key==='ArrowLeft'){dx=-grid;dy=0;moveSnake();}
  if(e.key==='ArrowRight'){dx=grid;dy=0;moveSnake();}
});

// بدء اللعبة
createMaze();
drawWalls();
placeCherry();
drawSnake();
</script>
</body>
</html>
